{"componentChunkName":"component---src-templates-blog-post-js","path":"/2011/12/11/help-with-cleanup/","webpackCompilationHash":"5db0e993e145acf31338","result":{"data":{"site":{"siteMetadata":{"title":"Mitchell Simoens Blog","author":"Mitchell Simoens"}},"markdownRemark":{"id":"ce29d569-75bd-51a3-a9b7-889c187aa53c","excerpt":"We are only in the developer preview stages of Sencha Touch 2 but we are already seeing so many great things. Performance in Android is superb. Scrolling is so…","html":"<p>We are only in the developer preview stages of <strong>Sencha Touch 2</strong> but we are already seeing so many great things. Performance in Android is superb. Scrolling is so native feeling that users won’t really be able to tell it’s really just a web page. Orientation changing is faster than the actual browser. The list goes on and on but I just stumbled on something that will help you clean up after your defined components.</p>\n<p>Lots of times, we as developers set references onto components to keep track of things. We now can use the config Object with the getters and setters which is very useful I have to admit. But sometimes that’s just a bit much for what we need. We just want to set a reference and refer to it whenever we want but the problem with this is it can leak memory. So what we would do is either listen for the destroy event or use one of the destroy methods and call the superclass. But what if <strong>Sencha Touch</strong> as a framework can take care of it? Enter the referenceList.</p>\n<p>Every subclass of <code class=\"language-text\">Ext.AbstractComponent</code> gets an Array placed as <code class=\"language-text\">referenceList</code>. All this is is an Array of Strings which are references on the component. You will see that the referenceList Array will have ‘element’ and sometimes ‘innerElement’ (depending on if it is an <code class=\"language-text\">Ext.Container</code> or subclass). When the component is destroyed, the destroy method will iterate over the referenceList Array, execute the destroy method on that reference and then delete it:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// Destroy all element references\nfor (i = 0,ln = referenceList.length; i &amp;amp;lt; ln; i++) {\n    reference = referenceList[i];\n    this[reference].destroy();\n    delete this[reference];\n}</code></pre></div>\n<p>Now you can see the comment says that it will destroy all element references but technically you can put anything in there that has a destroy method. Very simple to clean up your references. Let’s look at an example…</p>\n<p>Say you want a fullscreened <code class=\"language-text\">Ext.Container</code> but you need to detect when that <code class=\"language-text\">Ext.Container</code>’s size changes. By default, <code class=\"language-text\">Ext.Container</code> doesn’t monitor it’s own size so you have to initialize your own <code class=\"language-text\">Ext.util.SizeMonitor</code> in order to do this. I will caution you, <code class=\"language-text\">Ext.util.SizeMonitor</code> adds in overhead so don’t go crazy adding it to everything. This is an example of a subclass that does just this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Ext.define(&#39;MyContainer&#39;, {\n    extend : &#39;Ext.Container&#39;,\n\n    config : {\n        fullscreen : true\n    },\n\n    initialize: function() {\n        var me      = this,\n            refList = me.referenceList;\n\n        me.sizeMonitor = Ext.create(&#39;Ext.util.SizeMonitor&#39;, {\n            element  : me.element,\n            callback : me.onSizeChange,\n            scope    : me\n        });\n\n        me.on(&#39;painted&#39;, &#39;onPainted&#39;, me, { single : true });\n\n        me.callParent();\n    },\n\n    onPainted: function(cmp) {\n        cmp.sizeMonitor.refresh();\n    },\n\n    onSizeChange: function() {\n        this.fireEvent(&#39;sizechanged&#39;, this);\n    }\n});</code></pre></div>\n<p>Couple things I want to point out here. First, you can see we are placing a reference to the <code class=\"language-text\">Ext.util.SizeMonitor</code> instance to <code class=\"language-text\">this.sizeMonitor</code>. Second, you have to execute the refresh method on the <code class=\"language-text\">Ext.util.SizeMonitor</code> instance when the component has been painted, this is what will make the size change be picked up. This may be better suited for the config Object to get the getter and setter but it’s just an example for this blog post. So right now we have a fully working example with a reference that could be a memory leak, we could listen for the ‘destroy’ event and clean it up ourselves but there is a built in way to do it as mentioned before, the referenceList Array. So after you set the reference, we just need to push a String to the referenceList Array and it will automatically be cleaned up for us:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Ext.define(&#39;MyContainer&#39;, {\n    //..\n\n    initialize: function() {\n        var me      = this,\n            refList = me.referenceList;\n\n        me.sizeMonitor = Ext.create(&#39;Ext.util.SizeMonitor&#39;, {\n            element  : me.element,\n            callback : me.onSizeChange,\n            scope    : me\n        });\n        refList.push(&#39;sizeMonitor&#39;);\n\n        me.on(&#39;painted&#39;, &#39;onPainted&#39;, me, { single : true });\n\n        me.callParent();\n    },\n\n    //...\n});</code></pre></div>\n<p>That simple! But remember, it must have that destroy method or else you will get a JavaScript error as there is no check if a destroy method is present. Kind of wish there was for other references but it’s not really what this was meant for.</p>\n<p>Enjoy all the <strong>Sencha Touch 2</strong> goodness!</p>","fields":{"slug":"/2011/12/11/help-with-cleanup/"},"frontmatter":{"title":"Help with cleanup","date":"December 11, 2011"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2011/12/11/help-with-cleanup/","previous":null,"next":{"fields":{"slug":"/2011/12/17/about-me/"},"frontmatter":{"title":"About me"}}}}}